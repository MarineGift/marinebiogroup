(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56],{3180:function(e,t,a){Promise.resolve().then(a.bind(a,8463))},8463:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return n}});var r=a(7437),s=a(2265),l=a(3145),d=a(6538);function n(){let[e,t]=(0,s.useState)([]),[a,n]=(0,s.useState)(1),[i,c]=(0,s.useState)(0),[o,m]=(0,s.useState)(0),[x]=(0,s.useState)(12),[u,h]=(0,s.useState)([]),[b,g]=(0,s.useState)(""),[p,y]=(0,s.useState)(""),[j,f]=(0,s.useState)(!1),[v,N]=(0,s.useState)(""),[w,k]=(0,s.useState)(!1),[S,C]=(0,s.useState)(""),[E,P]=(0,s.useState)(""),[L,D]=(0,s.useState)(""),[U,_]=(0,s.useState)([]),[O,R]=(0,s.useState)([]),[F,I]=(0,s.useState)(!1),M=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";f(!0),N("");try{let s=new URLSearchParams({page:e.toString(),limit:x.toString(),...a&&{category:a},...r&&{search:r}}),l=await fetch("/api/gallery?".concat(s)),d=await l.json();d.success?(t(d.data),n(d.pagination.currentPage),c(d.pagination.totalPages),m(d.pagination.totalItems),h(d.categories)):N("갤러리 데이터를 불러오는데 실패했습니다.")}catch(e){N("네트워크 오류가 발생했습니다."),console.error("Error fetching gallery data:",e)}finally{f(!1)}};(0,s.useEffect)(()=>{M(a,b,p)},[a,b,p]);let q=e=>{let t=U.filter((t,a)=>a!==e),a=O.filter((t,a)=>a!==e);URL.revokeObjectURL(O[e]),_(t),R(a)},A=async()=>{if(!S.trim()){alert("제목을 입력해주세요.");return}if(!E.trim()){alert("카테고리를 입력해주세요.");return}if(0===U.length){alert("이미지를 선택해주세요.");return}I(!0);try{for(let e of U){let t=new FormData;if(t.append("title",S),t.append("category",E),t.append("description",L),t.append("image",e),!(await fetch("/api/gallery",{method:"POST",body:t})).ok)throw Error("업로드 실패")}alert("이미지가 성공적으로 업로드되었습니다."),C(""),P(""),D(""),_([]),R([]),k(!1),M(a,b,p)}catch(e){console.error("Upload error:",e),alert("업로드 중 오류가 발생했습니다.")}finally{I(!1)}},T=async e=>{if(confirm("정말 삭제하시겠습니까?"))try{(await fetch("/api/gallery/".concat(e),{method:"DELETE"})).ok?(alert("이미지가 삭제되었습니다."),M(a,b,p)):alert("삭제 중 오류가 발생했습니다.")}catch(e){console.error("Delete error:",e),alert("삭제 중 오류가 발생했습니다.")}};return(0,r.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"갤러리 관리"}),(0,r.jsx)("button",{onClick:()=>k(!0),className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"새 이미지 추가"})]}),(0,r.jsxs)("div",{className:"mb-6 flex gap-4 items-end",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"검색"}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n(1),M(1,b,p)},className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:p,onChange:e=>y(e.target.value),placeholder:"제목으로 검색...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"}),(0,r.jsx)("button",{type:"submit",className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"검색"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"카테고리"}),(0,r.jsxs)("select",{value:b,onChange:e=>{g(e.target.value),n(1)},className:"px-3 py-2 border border-gray-300 rounded-md",children:[(0,r.jsx)("option",{value:"",children:"전체"}),u.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})]}),j&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"로딩 중..."})]}),v&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:v}),!j&&!v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6",children:e.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[(0,r.jsx)("div",{className:"relative aspect-square",children:(0,r.jsx)(l.default,{src:e.image,alt:e.title,fill:!0,className:"object-cover"})}),(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("h3",{className:"font-medium truncate",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:e.category}),e.description&&(0,r.jsx)("p",{className:"text-xs text-gray-600 truncate",children:e.description}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,r.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.createdAt).toLocaleDateString()}),(0,r.jsx)("button",{onClick:()=>T(e.id),className:"text-red-500 hover:text-red-700 text-sm",children:"삭제"})]})]})]},e.id))}),0===e.length&&(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500",children:"갤러리 항목이 없습니다."})}),(0,r.jsx)(d.Z,{currentPage:a,totalPages:i,onPageChange:e=>{n(e)},showInfo:!0,itemsPerPage:x,totalItems:o})]}),w&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"새 이미지 추가"}),(0,r.jsx)("button",{onClick:()=>k(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"제목 *"}),(0,r.jsx)("input",{type:"text",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"이미지 제목을 입력하세요"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"카테고리 *"}),(0,r.jsx)("input",{type:"text",value:E,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"카테고리를 입력하세요"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"설명"}),(0,r.jsx)("textarea",{value:L,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:3,placeholder:"이미지 설명을 입력하세요"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"이미지 선택 (최대 5개) *"}),(0,r.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>{let t=Array.from(e.target.files||[]),a=t.filter(e=>e.type.startsWith("image/"));a.length!==t.length&&alert("이미지 파일만 업로드 가능합니다.");let r=a.slice(0,5);_(r),R(r.map(e=>URL.createObjectURL(e)))},className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),O.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"미리보기"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-2",children:O.map((e,t)=>(0,r.jsxs)("div",{className:"relative aspect-square border rounded",children:[(0,r.jsx)(l.default,{src:e,alt:"Preview ".concat(t+1),fill:!0,className:"object-cover rounded"}),(0,r.jsx)("button",{onClick:()=>q(t),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600",children:"✕"})]},t))})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,r.jsx)("button",{onClick:()=>k(!1),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",disabled:F,children:"취소"}),(0,r.jsx)("button",{onClick:A,disabled:F||0===U.length,className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:F?"업로드 중...":"업로드"})]})]})})]})}},6538:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(7437),s=a(2265);function l(e){let{currentPage:t,totalPages:a,onPageChange:l,showInfo:d=!0,itemsPerPage:n=10,totalItems:i=0}=e,[c,o]=(0,s.useState)([]);(0,s.useEffect)(()=>{o((()=>{let e=[];if(a<=5)for(let t=1;t<=a;t++)e.push(t);else{let r=Math.max(1,t-Math.floor(2.5)),s=Math.min(a,r+5-1);s-r+1<5&&(r=Math.max(1,s-5+1));for(let t=r;t<=s;t++)e.push(t)}return e})())},[t,a]);let m=e=>{e>=1&&e<=a&&e!==t&&l(e)};return a<=1?null:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4 mt-6",children:[d&&(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["페이지 ",t," / ",a,i>0&&(0,r.jsxs)("span",{className:"ml-2",children:["(총 ",i.toLocaleString(),"개 항목, 페이지당 ",n,"개)"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>{1!==t&&l(1)},disabled:1===t,className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"첫 페이지",children:"\xab\xab"}),(0,r.jsx)("button",{onClick:()=>{t>1&&l(t-1)},disabled:1===t,className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"이전 페이지",children:"‹"}),c.length>0&&c[0]>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>m(1),className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:"1"}),c[0]>2&&(0,r.jsx)("span",{className:"px-2 py-2 text-sm text-gray-400",children:"..."})]}),c.map(e=>(0,r.jsx)("button",{onClick:()=>m(e),className:"px-3 py-2 text-sm border rounded-md ".concat(e===t?"bg-blue-500 text-white border-blue-500":"border-gray-300 hover:bg-gray-50"),children:e},e)),c.length>0&&c[c.length-1]<a&&(0,r.jsxs)(r.Fragment,{children:[c[c.length-1]<a-1&&(0,r.jsx)("span",{className:"px-2 py-2 text-sm text-gray-400",children:"..."}),(0,r.jsx)("button",{onClick:()=>m(a),className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:a})]}),(0,r.jsx)("button",{onClick:()=>{t<a&&l(t+1)},disabled:t===a,className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"다음 페이지",children:"›"}),(0,r.jsx)("button",{onClick:()=>{t!==a&&l(a)},disabled:t===a,className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"마지막 페이지",children:"\xbb\xbb"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)("span",{children:"페이지 이동:"}),(0,r.jsx)("input",{type:"number",min:"1",max:a,className:"w-16 px-2 py-1 border border-gray-300 rounded text-center",onKeyDown:e=>{if("Enter"===e.key){let t=parseInt(e.target.value);t>=1&&t<=a&&(m(t),e.target.value="")}},placeholder:t.toString()}),(0,r.jsxs)("span",{children:["/ ",a]})]})]})}}},function(e){e.O(0,[145,971,117,744],function(){return e(e.s=3180)}),_N_E=e.O()}]);